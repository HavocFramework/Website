# 12. Client Script

This section describes all of the different API functions that can be used to
control the client side of havoc. The API scripting language of choice is python
to allow users to utilise the power and simplicity of python.

## Python API Documentation

The python api is divided in two main section the havoc and havocui modules. The
first is used to control the behaviour of havoc from scripts to interacting with
demons. The havocui module is used to control the User Interface of havoc by
creating widgets and tabs.

### havoc

The main havoc library that allows you to interact with core components of Havoc,
from listeners to connected demons, registering commands and events.

```
import havoc
```

##### havoc.LoadScript()

A function that takes a string as an argument to represent the path of a python
script that will then be loaded into havoc.

| Arguments   | Description                                                        | Optional   |
| ----------- | ------------------------------------------------------------------ | ---------- |
| script path | The script that will be loaded inside of havoc.                    | No         |

```
import havoc

havoc.LoadScript("/tmp/havoc_python_script.py")
```

##### havoc.GetDemons()

A function that takes no arguments and will return a list of strings containing
every Demon ID connected to havoc.

```
import havoc

print(havoc.GetDemons()) # should result in [ "a havoc id", "another", .... ]
```

##### havoc.GetListeners()

A function that takes no arguments and will return a list of strings containing
the different listeners configured inside of havoc.

```
import havoc

print(havoc.GetListeners()) # should result in [ "a listener", "another", .... ]
```

##### havoc.GetAgents()

A function that takes no arguments and will return a list of strings containing
the different Agents configured inside of havoc. By default this function will
only return "Demon" unless you specified other Agents.

```
import havoc

print(havoc.GetAgents()) # should result in [ "Demon", .... ]
```

##### havoc.GeneratePayload()

A function that takes multiple arguments defined below to schedule the generation
of a payload and receive the base64 binary code and transfer it back to a python
callback.

| Arguments | Description                                                        | Optional   |
| --------- | ------------------------------------------------------------------ | ---------- |
| callback  | The callback function where the base 64 will be parsed as argument | No         |
| agent     | The agent that will be used during the payload generation          | No         |
| listener  | The specified listener the agent will call back to                 | No         |
| arch      | The architecture of the generated payload (x64 or x86)             | No         |
| format    | The format of the generated payload (exe or dll for example)       | No         |
| config    | The configuration of the payload                                   | No         |

```
import havoc

def catch_payload(data):
    print(data)

havoc.GeneratePayload(catch_payload, "Demon", "HTTPS Listener", "x64", "Windows Exe", "{\"Amsi/Etw Patch\": \"None\",\"Indirect Syscall\": false,\"Injection\": {\"Alloc\": \"Native/Syscall\",\"Execute\": \"Native/Syscall\",\"Spawn32\": \"C:\\\\Windows\\\\SysWOW64\\\\notepad.exe\",\"Spawn64\": \"C:\\\\Windows\\\\System32\\\\notepad.exe\"},\"Jitter\": \"15\",\"Proxy Loading\": \"None (LdrLoadDll)\",\"Sleep\": \"2\",\"Sleep Technique\": \"WaitForSingleObjectEx\",\"Stack Duplication\": false}")
```

##### havoc.RegisterCommand()

A function to register a command to the havoc command line interface when
interacting with an agent.

| Arguments   | Description                                                                           | Optional   |
| ------------|-------------------------------------------------------------------------------------- | ---------- |
| function    | The callback function that will be called when running the function.                  | No         |
| module      | The string representing the module of the command.                                    | No         |
| command     | The string representing the command.                                                  | No         |
| description | The description of the command .                                                      | No         |
| behaviour   | set the behaviour of the command. For now keep at 0 it is still under developement.   | No         |
| usage       | The usage of the command.                                                             | No         |
| example     | An example on how to use the command.                                                 | No         |
| agent       | The specific agent that you want the command to be defined to. Default is all agents. | Yes        |

```
import havoc

def samdump(demonID, *params):
    TaskID : str    = None
    demon  : Demon  = None
    packer = Packer()
    # ... more code
    # see full example in the SamDump module
    # https://github.com/HavocFramework/Modules

RegisterCommand( samdump, "", "samdump", "Dump the SAM, SECURITY and SYSTEM registries", 0, "<folder>", "C:\\Windows\\Temp\\" )
```

##### havoc.RegisterModule()

A function to register a module to the havoc command line interface that will then
store multiple commands under the module.

| Arguments   | Description                                                                                        | Optional   |
| ------------|--------------------------------------------------------------------------------------------------- | ---------- |
| Name        | The name of the module that will store the commands                                                | No         |
| description | The description of the Module.                                                                     | No         |
| behaviour   | set the behaviour of the module. For now keep as an empty string it is still under development.    | No         |
| usage       | The usage of the module.                                                                           | No         |
| example     | An example on how to use the command.                                                              | No         |
| Options     | Still under development.                                                                           | No         |

```
import havoc

# more code ...
# see full example in the jmp-exec module
# https://github.com/HavocFramework/Modules

RegisterModule( "jump-exec", "lateral movement module", "", "[exploit] (args)", "", ""  )
```

##### havoc.RegisterCallback()

A function to register a callback inside of Havoc.

| Arguments   | Description                                             | Optional   |
| ------------|-------------------------------------------------------- | ---------- |
| callback    | The function that will be called during client connect. | No         |

_it is more recommended to use Events_

```
import havoc

def callback(text):
    print('this is a callback')

havoc.RegisterCallback(callback)
```

#### havoc.Demon()

A class to interact with a demon. Takes the demon identifier as argument.

| Arguments   | Description                                             | Optional   |
| ------------|-------------------------------------------------------- | ---------- |
| DemonId     | The string that represents the demon to control.        | No         |

```
import havoc

instance = havoc.Demon("identifier")
```

| Variables     | Description                                             | Default value |
| --------------|-------------------------------------------------------- | ------------- |
| Listener      | The Listener the demon is connected to.                 | NaN           |
| DemonID       | The string representing the identifier of the demon.    | NaN           |
| External IP   | The External IP address of the demon.                   | NaN           |
| Internal IP   | The Internal IP address of the demon.                   | NaN           |
| User          | The user running the demon.                             | NaN           |
| Computer      | The computer the demon is running on.                   | NaN           |
| Domain        | The Domain the demon is part off.                       | NaN           |
| OS            | The Operating system of the demon.                      | NaN           |
| OSBuild       | The Operating system build information.                 | NaN           |
| OSArch        | The Architecture of the Operating system.               | NaN           |
| ProcessName   | The name of the process running the demon.              | NaN           |
| ProcessID     | The ID number of the process running the demon.         | NaN           |
| ProcessArch   | The Architecture of the process running the demon.      | NaN           |
| --------------|-------------------------------------------------------- | ------------- |
| CONSOLE_INFO  | The console message type information.                   | 1             |
| CONSOLE_ERROR | The console message type error.                         | 2             |
| CONSOLE_TASK  | The console message type task.                          | 3             |

##### havoc.Demon().ConsoleWrite()

A function that takes two arguments to write on the console of an agent. This function
will return a taskId depending on the argument specified to the function.

| Arguments   | Description                                              | Optional   |
| ------------|--------------------------------------------------------- | ---------- |
| Type        | The type of message requested                            | No         |
| Message     | The message to be displayed on the console of the agent. | No         |

| Message type  | Description                                              | Value   |
| --------------|--------------------------------------------------------- | ------- |
| CONSOLE_INFO  | The console message type information.                    | 1       |
| CONSOLE_ERROR | The console message type error.                          | 2       |
| CONSOLE_TASK  | The console message type task.                           | 3       |

```
import havoc

instance = havoc.Demon("identifier")
instance.ConsoleWrite(havoc.CONSOLE_INFO, "Hello World")
```

##### havoc.Demon().ProcessCreate()

A function to create a process on the demon. This function will take six arguments
to manage the process.

| Arguments   | Description                                                | Optional   |
| ------------|----------------------------------------------------------- | ---------- |
| TaskId      | The Identifier of the task sent to the demon.              | No         |
| App         | The application to be ran on the target demon.             | No         |
| CmdLine     | The command line arguments to the process.                 | No         |
| Suspend     | A boolean value if you wish to have the process suspended. | No         |
| Piped       | A boolean value if the process is piped.                   | No         |
| Verbose     | A boolean value if the process is verbose.                 | No         |

```
import havoc

instance = havoc.Demon("identifier")
TaskID = instance.ConsoleWrite(havoc.CONSOLE_TASK, "Launching a process")
instance.ProcessCreate(TaskID, "notepad.exe", "", False, False, False)
```

##### havoc.Demon().InlineExecute()

Execute a beacon object file on the selected demon instance. The function takes
five arguments to execute the file.

| Arguments   | Description                                                   | Optional   |
| ------------|-------------------------------------------------------------- | ---------- |
| TaskId      | The Identifier of the task sent to the demon.                 | No         |
| EntryFunc   | The entry function of the beacon object file.                 | No         |
| Path        | The path to the beacon object file.                           | No         |
| ArgBytes    | The different arguments to send to the function.              | No         |
| Threaded    | A boolean value if the beacon object file is ran in a thread. | No         |

```
import havoc

# Example taken form samdump.
# https://github.com/HavocFramework/Modules

instance = havoc.Demon("identifier")
TaskID = instance.ConsoleWrite(havoc.CONSOLE_TASK, "Launching a bof file")
demon.InlineExecute( TaskID, "go", f"regdump.samdump.o", packer.getbuffer(), False )
```

##### havoc.Demon().InlineExecuteGetOutput()

Execute a beacon object file on the selected demon instance. The function takes
Four arguments to execute the file and returns the output through a callback.

| Arguments   | Description                                                   | Optional   |
| ------------|-------------------------------------------------------------- | ---------- |
| Callback    | The callback to receive the output of the beacon file.        | No         |
| EntryFunc   | The entry function of the beacon object file.                 | No         |
| Path        | The path to the beacon object file.                           | No         |
| ArgBytes    | The different arguments to send to the function.              | No         |

```
import havoc

# Example inspired form bofbelt.
# https://github.com/HavocFramework/Modules

instance = havoc.Demon("identifier")

def callback(demonID, TaskID, worked, output, error):
	# demonID: the ID of the demon that ran the BOF
	# TaskID : the ID of the task returned by demon.InlineExecuteGetOutput
	# worked : weather the BOF was able to run or not
	# output : the content of all CALLBACK_OUTPUT
	# error  : the content of all CALLBACK_ERROR
	global instance
	if  worked:
		instance.ConsoleWrite(demon.CONSOLE_INFO, output)
	else:
		instance.ConsoleWrite(demon.CONSOLE_ERROR, output)

demon.InlineExecuteGetOutput( callback , "go", f"regdump.samdump.o", packer.getbuffer(), False )
```
##### havoc.Demon().DllSpawn()

Spawn a dll on the demon. This function takes three arguments.

| Arguments     | Description                                                   | Optional   |
| --------------|-------------------------------------------------------------- | ---------- |
| TaskID        | The identifier number of the task to the demon.               | No         |
| Dll path      | The path of the dll to run on the machine.                    | No         |
| Dll arguments | The arguments to the dll.                                     | No         |

```
import havoc

# Example taken from powerpick.
# https://github.com/HavocFramework/Modules

instance = havoc.Demon("identifier")
TaskID = instance.ConsoleWrite(havoc.CONSOLE_TASK, "Launching a dll file")
demon.DllSpawn( TaskID, "bin/PowerPick.x64.dll", packer.getbuffer() )
```

##### havoc.Demon().DllInject()

Spawn a dll on the demon inside of an existing process . This function takes
four arguments.

| Arguments     | Description                                                   | Optional   |
| --------------|-------------------------------------------------------------- | ---------- |
| TaskID        | The identifier number of the task to the demon.               | No         |
| PID           | Process identifier to inject in.                              | No         |
| Dll path      | The path of the dll to run on the machine.                    | No         |
| Dll arguments | The arguments to the dll.                                     | No         |

```
import havoc

# Example inspired from powerpick.
# https://github.com/HavocFramework/Modules

instance = havoc.Demon("identifier")
TaskID = instance.ConsoleWrite(havoc.CONSOLE_TASK, "Launching a dll file")
demon.DllSpawn( TaskID, "1030", "bin/PowerPick.x64.dll", packer.getbuffer() )
```

##### havoc.Demon().DotnetInlineExecute()

Run a dotnet binary inside of the demon instance. This function takes three arguments.

| Arguments     | Description                                                   | Optional   |
| --------------|-------------------------------------------------------------- | ---------- |
| TaskID        | The identifier number of the task to the demon.               | No         |
| Path          | The path of the exe to run on the machine.                    | No         |
| Arguments     | The arguments to the exe.                                     | No         |

```
import havoc

instance = havoc.Demon("identifier")
TaskID = instance.ConsoleWrite(havoc.CONSOLE_TASK, "Launching a dotnet exe file")
demon.DotnetInlineExecute( TaskID, "/opt/exe/SharpChrome.exe", "all the arguments" ) )
```

##### havoc.Demon().Command()

Run a command inside of the demon instance. This function takes two arguments.

| Arguments     | Description                                                   | Optional   |
| --------------|-------------------------------------------------------------- | ---------- |
| TaskID        | The identifier number of the task to the demon.               | No         |
| Command       | The command to run on the demon.                              | No         |

```
import havoc

# example taken from auto_suite.py
# https://gist.github.com/p4p1/e24bca8407d69c8ea28d4bc9d423f85b

instance = havoc.Demon("identifier")
TaskID = instance.ConsoleWrite(havoc.CONSOLE_TASK, "Launching a command")
demon.DotnetInlineExecute( TaskID, "powershell \"Get-ChildItem -Path C:\\\\ -Filter *.exe -Recurse\"") )
```

#### havoc.Event()

The event class in python used to hook functions on events inside of havoc.

```
import havoc

# currently takes a string as argument but is not used...
event = havoc.Event("events")
```

##### havoc.Event().OnNewSession()

Run a callback function when a new session is joined on havoc.

| Arguments     | Description                                                        | Optional   |
| --------------|------------------------------------------------------------------- | ---------- |
| Callback      | The function that will ran on a new session is connected to havoc. | No         |

```
import havoc

# Example inspired of auto_suite.py
# https://gist.github.com/p4p1/e24bca8407d69c8ea28d4bc9d423f85b

def run_bofbelt(demon_id):
    demon = havoc.Demon(demon_id)
    TaskID = demon.ConsoleWrite( demon.CONSOLE_TASK, "Tasked demon to auto-run bofbelt" )
    demon.Command(TaskID, "bofbelt")

# currently takes a string as argument but is not used...
event = havoc.Event("events")

event.OnNewSession(run_bofbelt)
```

### havocui

The havocui section is built to interact with the User Interface of havoc. It
allows users to interact with your modules through custom menu's and interfaces.
The havocui module ranges from simple message boxes to Full fledged dialog,
widgets and pre built widgets that allow you to display important information
like logs.

```
import havocui
```

##### havocui.messagebox()

Create a simple message box to display text. This function takes two arguments.

| Arguments     | Description                                                        | Optional   |
| --------------|------------------------------------------------------------------- | ---------- |
| Title         | The title of the message box.                                      | No         |
| Message       | The message to be displayed inside of your message box.            | No         |

```
import havocui

havocui.messagebox("sample message box", "Hello World!")
```

![message box](/images/assets/pythonapi/messagebox.png)

##### havocui.errormessage()

Create a simple message box to display an error message. This function takes one
argument.

| Arguments     | Description                                                        | Optional   |
| --------------|------------------------------------------------------------------- | ---------- |
| Message       | The message to be displayed inside of your error box.              | No         |

```
import havocui

havocui.errormessage("This is an error :(")
```

![error box](/images/assets/pythonapi/errormessage.png)

##### havocui.createtab()

Function to create a tab menu element to display. This function takes an infinite
number of arguments but should at minimum take 3.

| Arguments     | Description                                                        | Optional   |
| --------------|------------------------------------------------------------------- | ---------- |
| Tab title     | The title of the tab inside of the havoc GUI.                      | No         |
| Element title | The title of the element inside of the tab.                        | No         |
| callback      | The callback function for when the tab is selected.                | No         |
| ------------- | ------------------------------------------------------------------ | ---------- |
| Element title | The title of the element inside of the tab.                        | Yes        |
| callback      | The callback function for when the tab is selected.                | Yes        |

```
import havocui

# code taken from auto_suite.py
# https://gist.github.com/p4p1/e24bca8407d69c8ea28d4bc9d423f85b

def open_autosearch():
	# some code
	# ....

havocui.createtab("Auto Suite", "Auto search", open_autosearch)
```

![create tab](/images/assets/pythonapi/createtab.png)

##### havocui.inputdialog()

Create a simple dialog box that will get user input. This function takes two
arguments and will return the data entered by the user. If cancel is selected
the return string will be empty.

| Arguments     | Description                                                        | Optional   |
| --------------|------------------------------------------------------------------- | ---------- |
| Title         | The title of the input box.                                        | No         |
| Message       | The message to be displayed inside of your input box.              | No         |

```
import havocui

print(havocui.errormessage("Enter something", "Please provide your name:"))
# should result in displaying in the console the text entered
```

![input dialog](/images/assets/pythonapi/inputdialog.png)

##### havocui.openfiledialog()

A function that will open a dialog box to open a file. This function takes one
argument and will return the path to the file.

| Arguments     | Description                                                        | Optional   |
| --------------|------------------------------------------------------------------- | ---------- |
| Title         | The title of the open file dialog.                                 | No         |

```
import havocui

print(havocui.openfiledialog("select file"))
# should result in displaying in the console the path and the file selected
```

![open file dialog](/images/assets/pythonapi/openfiledialog.png)

##### havocui.savefiledialog()

A function that will open a dialog box to save a file. This function takes one
argument and will return the path to the file.

| Arguments     | Description                                                        | Optional   |
| --------------|------------------------------------------------------------------- | ---------- |
| Title         | The title of the save file dialog.                                 | No         |

```
import havocui

print(havocui.savefiledialog("save file"))
# should result in displaying in the console the path and the file entered
```

![save file dialog](/images/assets/pythonapi/savefiledialog.png)

##### havocui.questiondialog()

A function that will open a dialog with a yes and no option. This function takes two
arguments and returns a boolean depending on the answer.

| Arguments     | Description                                                        | Optional   |
| --------------|------------------------------------------------------------------- | ---------- |
| Title         | The title of the question dialog.                                  | No         |
| Question      | The question asked to the user.                                    | No         |

```
import havocui

value = havocui.questiondialog("question", "Are you happy?")
if value == True:
	print("you are happy")
else:
	havocui.inputdialog("why...", "why are you sad?")
```

![question dialog](/images/assets/pythonapi/questiondialog.png)

##### havocui.colordialog()

A function that opens a dialog box to pick colors. This function takes no arguments
and returns the hexadecimal color code.

```
import havocui

print(havocui.colordialog())
# this will result in displaying the hex color code in the console
```

![color dialog](/images/assets/pythonapi/colordialog.png)

##### havocui.progressdialog()

A function that opens a dialog box to display the progress of a long operation.
This function takes four arguments.

| Arguments     | Description                                                        | Optional   |
| --------------|------------------------------------------------------------------- | ---------- |
| Title         | The title of the progress dialog.                                  | No         |
| Message       | The message to be displayed during progress.                       | No         |
| Callback      | The callback function to set the behavior of the progress.         | No         |
| Number        | The number to set the number of iterations to call the callback.   | No         |

```
import havocui

a = 0

def callback():
    global a
    a += 1
    if a > 100:
        a = -1 # return a negative number to automatically close the dialog.
    return a

havocui.progressdialog("progress bar", "This task might take some time...", callback, 100)
```

![progress dialog](/images/assets/pythonapi/progressdialog.png)

#### havocui.Dialog()

##### havocui.Dialog().exec()
##### havocui.Dialog().close()
##### havocui.Dialog().addLabel()
##### havocui.Dialog().addImage()
##### havocui.Dialog().addButton()
##### havocui.Dialog().addCheckbox()
##### havocui.Dialog().addCombobox()
##### havocui.Dialog().addLineedit()
##### havocui.Dialog().addCalendar()
##### havocui.Dialog().addDial()
##### havocui.Dialog().addSlider()
##### havocui.Dialog().replaceLabel()
##### havocui.Dialog().clear()

#### havocui.Widget()

##### havocui.Dialog().setBottomTab()
##### havocui.Dialog().setSmallTab()
##### havocui.Dialog().addLabel()
##### havocui.Dialog().addImage()
##### havocui.Dialog().addButton()
##### havocui.Dialog().addCheckbox()
##### havocui.Dialog().addCombobox()
##### havocui.Dialog().addLineedit()
##### havocui.Dialog().addCalendar()
##### havocui.Dialog().addDial()
##### havocui.Dialog().addSlider()
##### havocui.Dialog().replaceLabel()
##### havocui.Dialog().clear()

#### havocui.Logger()

##### havocui.Dialog().setBottomTab()
##### havocui.Dialog().setSmallTab()
##### havocui.Dialog().addText()
##### havocui.Dialog().clear()

#### havocui.Tree()
##### havocui.Tree().addRow()
##### havocui.Tree().setItem()
##### havocui.Tree().setBottomTab()
##### havocui.Tree().setSmallTab()

## Examples
